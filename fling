-- SUPER FLING (FIXED: NO SELF-DEATH, REAL TARGETING)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

local LP = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- ================= CONFIG =================
local ORBIT_RADIUS = 6
local ORBIT_SPEED = 8
local CHASE_FORCE = 140
local PREDICTION = 0.22
local MAX_DIST = 50

-- ================= STATE =================
local targetPlayer = nil
local targetUserId = nil
local flingMode = "Orbit" -- Orbit / Fast / Direct
local cameraLock = false

-- ================= CHARACTER SAFETY =================
local function prepCharacter(char)
	for _, p in ipairs(char:GetDescendants()) do
		if p:IsA("BasePart") then
			p.CanCollide = false
		end
	end
end

-- ================= GUI =================
local gui = Instance.new("ScreenGui", LP.PlayerGui)
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 270, 0, 420)
frame.Position = UDim2.new(0, 10, 0.35, 0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Instance.new("UICorner", frame)

local function btn(text, y)
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2.new(1,-20,0,26)
	b.Position = UDim2.new(0,10,0,y)
	b.Text = text
	b.Font = Enum.Font.SourceSans
	b.TextSize = 14
	b.TextColor3 = Color3.new(1,1,1)
	b.BackgroundColor3 = Color3.fromRGB(60,60,60)
	return b
end

local startBtn = btn("Start Fling", 10)
startBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)

local targetBtn = btn("Select Target ▼", 45)

local dropdown = Instance.new("ScrollingFrame", frame)
dropdown.Position = UDim2.new(0,10,0,75)
dropdown.Size = UDim2.new(1,-20,0,140)
dropdown.BackgroundColor3 = Color3.fromRGB(40,40,40)
dropdown.Visible = false
dropdown.ScrollBarThickness = 6

local layout = Instance.new("UIListLayout", dropdown)

local modeBtn = btn("Mode: Orbit", 225)
local camBtn = btn("Camera Lock: OFF", 255)

local status = Instance.new("TextLabel", frame)
status.Position = UDim2.new(0,10,0,290)
status.Size = UDim2.new(1,-20,0,20)
status.BackgroundTransparency = 1
status.TextColor3 = Color3.new(1,1,1)
status.Font = Enum.Font.SourceSans
status.TextXAlignment = Enum.TextXAlignment.Left
status.Text = "Status: Idle"

-- ================= TARGET DROPDOWN =================
local function refreshTargets()
	for _, c in ipairs(dropdown:GetChildren()) do
		if c:IsA("TextButton") then c:Destroy() end
	end

	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LP then
			local b = Instance.new("TextButton", dropdown)
			b.Size = UDim2.new(1,-6,0,24)
			b.Text = p.Name
			b.Font = Enum.Font.SourceSans
			b.TextSize = 14
			b.TextColor3 = Color3.new(1,1,1)
			b.BackgroundColor3 = Color3.fromRGB(70,70,70)

			b.MouseButton1Click:Connect(function()
				targetPlayer = p
				targetUserId = p.UserId
				targetBtn.Text = "Target: "..p.Name.." ▼"
				status.Text = "Status: Target Locked"
				dropdown.Visible = false
			end)
		end
	end

	dropdown.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y)
end

targetBtn.MouseButton1Click:Connect(function()
	dropdown.Visible = not dropdown.Visible
	refreshTargets()
end)

Players.PlayerRemoving:Connect(function(p)
	if targetUserId and p.UserId == targetUserId then
		targetPlayer = nil
		status.Text = "Status: Waiting for target"
	end
end)

Players.PlayerAdded:Connect(function(p)
	if targetUserId and p.UserId == targetUserId then
		targetPlayer = p
		status.Text = "Status: Target Rejoined"
	end
end)

-- ================= CONTROLS =================
modeBtn.MouseButton1Click:Connect(function()
	if flingMode == "Orbit" then flingMode = "Fast"
	elseif flingMode == "Fast" then flingMode = "Direct"
	else flingMode = "Orbit" end
	modeBtn.Text = "Mode: "..flingMode
end)

camBtn.MouseButton1Click:Connect(function()
	cameraLock = not cameraLock
	camBtn.Text = "Camera Lock: "..(cameraLock and "ON" or "OFF")
end)

-- ================= FLING CORE (SAFE) =================
local conn
startBtn.MouseButton1Click:Connect(function()
	if conn then
		conn:Disconnect()
		conn = nil
		startBtn.Text = "Start Fling"
		status.Text = "Status: Stopped"
		return
	end

	if not targetUserId then
		status.Text = "Status: No target"
		return
	end

	local char = LP.Character or LP.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	prepCharacter(char)

	local bv = Instance.new("BodyVelocity", hrp)
	bv.MaxForce = Vector3.new(1e6, 0, 1e6)

	local bav = Instance.new("BodyAngularVelocity", hrp)
	bav.MaxTorque = Vector3.new(0, 1e6, 0)

	startBtn.Text = "Stop Fling"
	status.Text = "Status: Flinging"

	conn = RunService.Heartbeat:Connect(function()
		if not targetPlayer or not targetPlayer.Character then return end
		local thrp = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
		if not thrp then return end

		local vel = thrp.AssemblyLinearVelocity
		local predicted = thrp.Position + Vector3.new(vel.X, 0, vel.Z) * PREDICTION

		local offset
		if flingMode == "Orbit" then
			offset = Vector3.new(math.cos(tick()*ORBIT_SPEED)*ORBIT_RADIUS, 0,
								 math.sin(tick()*ORBIT_SPEED)*ORBIT_RADIUS)
			bav.AngularVelocity = Vector3.new(0, 20, 0)
		elseif flingMode == "Fast" then
			offset = Vector3.new(math.cos(tick()*ORBIT_SPEED*2)*8, 0,
								 math.sin(tick()*ORBIT_SPEED*2)*8)
			bav.AngularVelocity = Vector3.new(0, 40, 0)
		else
			offset = Vector3.zero
			bav.AngularVelocity = Vector3.zero
		end

		local goal = predicted + offset
		local dir = (goal - hrp.Position)
		if dir.Magnitude > MAX_DIST then
			hrp.CFrame = CFrame.new(goal)
		end

		bv.Velocity = dir.Unit * CHASE_FORCE

		if cameraLock then
			Camera.CameraSubject = thrp
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, thrp.Position)
		end
	end)
end)
