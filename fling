--- TRUE ROCKET FLING (Lock â†’ Orbit)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- ================= GUI =================
local gui = Instance.new("ScreenGui", PlayerGui)
gui.Name = "TrueRocketFling"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,260,0,300)
frame.Position = UDim2.new(0,10,0.4,0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Instance.new("UICorner", frame)

local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(1,-20,0,40)
toggle.Position = UDim2.new(0,10,0,10)
toggle.Text = "Start Fling"
toggle.BackgroundColor3 = Color3.fromRGB(0,170,255)
toggle.TextColor3 = Color3.new(1,1,1)
toggle.Font = Enum.Font.SourceSansBold
toggle.TextSize = 16

local status = Instance.new("TextLabel", frame)
status.Size = UDim2.new(1,-20,0,20)
status.Position = UDim2.new(0,10,0,60)
status.Text = "Status: Idle"
status.TextColor3 = Color3.new(1,1,1)
status.BackgroundTransparency = 1
status.TextXAlignment = Enum.TextXAlignment.Left

-- ================= TARGET TRACK =================
local selectedPlayer
local selectedUserId
local trackedHRP
local lastTargetPos
local charConn

local function hookCharacter(char)
	trackedHRP = char:WaitForChild("HumanoidRootPart",5)
	lastTargetPos = nil
end

local function trackPlayer(player)
	selectedPlayer = player
	selectedUserId = player.UserId
	trackedHRP = nil
	if charConn then charConn:Disconnect() end

	if player.Character then
		task.spawn(hookCharacter, player.Character)
	end

	charConn = player.CharacterAdded:Connect(function(char)
		task.wait(0.05)
		hookCharacter(char)
	end)
end

Players.PlayerAdded:Connect(function(p)
	if selectedUserId and p.UserId == selectedUserId then
		trackPlayer(p)
		status.Text = "Status: Target Rejoined"
	end
end)

-- ================= FLING =================
local flingConn
local ROCKET_DISTANCE = 12

local function startFling()
	if not selectedPlayer then
		status.Text = "Status: No target"
		return
	end

	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	status.Text = "Status: Flinging"

	flingConn = RunService.Heartbeat:Connect(function(dt)
		if not trackedHRP then return end

		-- ===== TARGET PREDICTION =====
		local targetPos = trackedHRP.Position
		if lastTargetPos then
			local vel = (targetPos - lastTargetPos) / dt
			targetPos += vel * 0.25 -- STRONG prediction
		end
		lastTargetPos = trackedHRP.Position

		local dir = targetPos - hrp.Position
		local dist = dir.Magnitude
		if dist == 0 then return end

		-- ===== PHASE 1: ROCKET LOCK =====
		if dist > ROCKET_DISTANCE then
			-- AIM THROUGH THE TARGET (overshoot)
			local overshoot = dir.Unit * 3
			char:PivotTo(CFrame.new(targetPos + overshoot))

			local speed = math.clamp(400 + dist * 8, 400, 1200)
			hrp.AssemblyLinearVelocity = dir.Unit * speed

		-- ===== PHASE 2: ORBIT FLING =====
		else
			local angle = tick() * math.rad(1500)
			local offset = Vector3.new(math.cos(angle)*5, 0, math.sin(angle)*5)
			char:PivotTo(CFrame.new(trackedHRP.Position + offset))

			hrp.AssemblyAngularVelocity = Vector3.new(9999,9999,9999)
			hrp.AssemblyLinearVelocity = dir.Unit * 300
		end
	end)
end

toggle.MouseButton1Click:Connect(function()
	if flingConn then
		flingConn:Disconnect()
		flingConn = nil
		status.Text = "Status: Stopped"
		toggle.Text = "Start Fling"
	else
		startFling()
		toggle.Text = "Stop Fling"
	end
end)
