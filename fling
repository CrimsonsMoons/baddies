--- Super Fling GUI (Advanced Prediction + Persistent Target)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Stats = game:GetService("Stats")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Camera = workspace.CurrentCamera

-- =====================
-- CONFIG
-- =====================
local MAX_SNAP_DISTANCE = 40
local BASE_PREDICTION = 0.15
local MAX_PREDICTION = 0.35

-- =====================
-- GUI SETUP
-- =====================
local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "FlingOrbitGUI"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 260, 0, 400)
mainFrame.Position = UDim2.new(0, 10, 0.35, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)

local function makeButton(text, y)
	local b = Instance.new("TextButton", mainFrame)
	b.Size = UDim2.new(1, -20, 0, 22)
	b.Position = UDim2.new(0, 10, 0, y)
	b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	b.Text = text
	b.TextColor3 = Color3.new(1,1,1)
	b.Font = Enum.Font.SourceSans
	b.TextSize = 14
	return b
end

local toggleBtn = makeButton("Start Fling", 10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)

local playerBtn = makeButton("Select Player", 40)
local predBox = makeButton("Prediction: 0.15", 70)
local snapToggle = makeButton("Snap Back: ON", 100)
local camToggle = makeButton("Camera Lock: OFF", 130)

local statusLabel = Instance.new("TextLabel", mainFrame)
statusLabel.Size = UDim2.new(1, -20, 0, 20)
statusLabel.Position = UDim2.new(0, 10, 0, 160)
statusLabel.Text = "Status: Idle"
statusLabel.TextColor3 = Color3.new(1,1,1)
statusLabel.BackgroundTransparency = 1
statusLabel.Font = Enum.Font.SourceSans
statusLabel.TextSize = 14
statusLabel.TextXAlignment = Enum.TextXAlignment.Left

local distLabel = statusLabel:Clone()
distLabel.Position = UDim2.new(0,10,0,180)
distLabel.Text = "Distance: N/A"
distLabel.Parent = mainFrame

-- =====================
-- TARGET TRACKING
-- =====================
local selectedPlayer
local selectedUserId
local snapEnabled = true
local cameraLock = false
local predictionStrength = BASE_PREDICTION

-- =====================
-- UTIL
-- =====================
local function getPing()
	local net = Stats.Network.ServerStatsItem["Data Ping"]:GetValue()
	return math.clamp(net / 1000, 0.05, 0.25)
end

local function getPrediction(hrp)
	local ping = getPing()
	local vel = hrp.AssemblyLinearVelocity
	local jumpBoost = Vector3.new(0, math.clamp(vel.Y, -50, 50), 0)
	return hrp.Position + (vel * predictionStrength) + jumpBoost
end

-- =====================
-- PLAYER SELECTION
-- =====================
playerBtn.MouseButton1Click:Connect(function()
	for _, p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer then
			selectedPlayer = p
			selectedUserId = p.UserId
			playerBtn.Text = "Target: " .. p.Name
			statusLabel.Text = "Status: Target Locked"
			break
		end
	end
end)

Players.PlayerAdded:Connect(function(p)
	if selectedUserId and p.UserId == selectedUserId then
		selectedPlayer = p
		statusLabel.Text = "Status: Target Rejoined"
	end
end)

Players.PlayerRemoving:Connect(function(p)
	if selectedUserId and p.UserId == selectedUserId then
		selectedPlayer = nil
		statusLabel.Text = "Status: Waiting for target"
	end
end)

-- =====================
-- TOGGLES
-- =====================
predBox.MouseButton1Click:Connect(function()
	predictionStrength += 0.05
	if predictionStrength > MAX_PREDICTION then
		predictionStrength = BASE_PREDICTION
	end
	predBox.Text = string.format("Prediction: %.2f", predictionStrength)
end)

snapToggle.MouseButton1Click:Connect(function()
	snapEnabled = not snapEnabled
	snapToggle.Text = "Snap Back: " .. (snapEnabled and "ON" or "OFF")
end)

camToggle.MouseButton1Click:Connect(function()
	cameraLock = not cameraLock
	camToggle.Text = "Camera Lock: " .. (cameraLock and "ON" or "OFF")
end)

-- =====================
-- FLING CORE
-- =====================
local flingConn
toggleBtn.MouseButton1Click:Connect(function()
	if flingConn then
		flingConn:Disconnect()
		flingConn = nil
		statusLabel.Text = "Status: Stopped"
		toggleBtn.Text = "Start Fling"
		Camera.CameraSubject = LocalPlayer.Character:FindFirstChild("Humanoid")
		return
	end

	if not selectedUserId then
		statusLabel.Text = "Status: No target"
		return
	end

	toggleBtn.Text = "Stop Fling"
	statusLabel.Text = "Status: Flinging"

	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")

	flingConn = RunService.Heartbeat:Connect(function()
		if not selectedPlayer then
			for _, p in ipairs(Players:GetPlayers()) do
				if p.UserId == selectedUserId then
					selectedPlayer = p
					break
				end
			end
			return
		end

		local tch = selectedPlayer.Character
		if not tch then return end
		local thrp = tch:FindFirstChild("HumanoidRootPart")
		if not thrp then return end

		local predicted = getPrediction(thrp)
		local dist = (predicted - hrp.Position).Magnitude

		if snapEnabled and dist > MAX_SNAP_DISTANCE then
			hrp.CFrame = CFrame.new(predicted)
		end

		local angle = tick() * 12
		local offset = Vector3.new(math.cos(angle)*5, 0, math.sin(angle)*5)

		char:PivotTo(CFrame.new(predicted + offset))
		hrp.AssemblyAngularVelocity = Vector3.new(9999,9999,9999)
		hrp.AssemblyLinearVelocity = (predicted - hrp.Position).Unit * 260

		if cameraLock then
			Camera.CameraSubject = thrp
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, predicted)
		end

		distLabel.Text = string.format("Distance: %.1f", dist)
	end)
end)
