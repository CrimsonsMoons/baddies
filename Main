local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Remote = RS:WaitForChild("Event", 9e9)

-- SETTINGS
local HIT_DELAY = 0.1
local STOMP_DELAY = 0.05
local STOMP_REPEAT = 5
local FOLLOW_DISTANCE = 2
local STOMP_HP = 1

--- Utils
local function getHum(char)
	return char and char:FindFirstChildOfClass("Humanoid")
end

local function getHRP(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

local function hit(part)
	Remote:FireServer({
		Event = "Hit",
		ClientHitbox = { part }
	})
end

local function stomp()
	Remote:FireServer({ Event = "Stomp" })
end

-- MAIN LOOP (never locks up)
while true do
	task.wait(0.1)

	local myChar = LocalPlayer.Character
	local myHRP = getHRP(myChar)
	if not myHRP then continue end

	for _, plr in ipairs(Players:GetPlayers()) do
		if plr == LocalPlayer then continue end

		local enemyChar = plr.Character
		local hum = getHum(enemyChar)
		local hrp = getHRP(enemyChar)

		-- skip invalid targets
		if not hum or not hrp or hum.Health <= 0 then
			continue
		end

		-- ðŸ”´ FOLLOW + HIT
		while hum.Parent and hum.Health > STOMP_HP do
			if not hrp.Parent then break end

			myHRP.CFrame = CFrame.new(
				hrp.Position - hrp.CFrame.LookVector * FOLLOW_DISTANCE,
				hrp.Position
			)

			hit(hrp)
			task.wait(HIT_DELAY)
		end

		-- ðŸ¦¶ STOMP + STAY UNTIL RESPAWN
		if hum.Parent and hum.Health <= STOMP_HP then
			local oldCharacter = enemyChar

			while oldCharacter == plr.Character do
				local currentHRP = getHRP(plr.Character)
				if currentHRP then
					myHRP.CFrame = currentHRP.CFrame
				end

				for i = 1, STOMP_REPEAT do
					stomp()
					task.wait(STOMP_DELAY)
				end

				task.wait(0.1)
			end
		end

		-- move to next player cleanly
		task.wait(0.2)
	end
end
