local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Remote = ReplicatedStorage:WaitForChild("Event", 9e9)

-- Settings
local HIT_DELAY = 0.12
local STOMP_DELAY = 0.05
local STOMP_REPEAT = 6
local BEHIND_DISTANCE = 2
local ENEMY_STOMP_HP = 1

-- Utility functions
local function getHRP(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

local function getHumanoid(char)
	return char and char:FindFirstChildOfClass("Humanoid")
end

local function fireHit(hitPart)
	Remote:FireServer({
		Event = "Hit",
		ClientHitbox = { hitPart }
	})
end

local function fireStomp()
	Remote:FireServer({
		Event = "Stomp"
	})
end

-- Main loop
while true do
	task.wait(0.2)

	local myChar = LocalPlayer.Character
	local myHRP = getHRP(myChar)
	if not myHRP then continue end

	local originalCFrame = myHRP.CFrame
	local targetFound = false

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local enemyChar = player.Character
			local enemyHRP = getHRP(enemyChar)
			local enemyHum = getHumanoid(enemyChar)

			if enemyHRP and enemyHum and enemyHum.Health > 0 then
				-- Step 1: Teleport behind
				myHRP.CFrame = CFrame.new(
					enemyHRP.Position - enemyHRP.CFrame.LookVector * BEHIND_DISTANCE,
					enemyHRP.Position
				)

				-- Step 2: Hit while enemy HP > 1
				while enemyHum and enemyHum.Health > ENEMY_STOMP_HP do
					fireHit(enemyHRP)
					task.wait(HIT_DELAY)
				end

				-- Step 3: Stomp when enemy HP <= 1
				if enemyHum and enemyHum.Health <= ENEMY_STOMP_HP then
					myHRP.CFrame = enemyHRP.CFrame

					while enemyChar.Parent do
						for i = 1, STOMP_REPEAT do
							fireStomp()
							task.wait(STOMP_DELAY)
						end
						task.wait(0.2)
					end

					-- Step 4: After they respawn, teleport back
					myHRP.CFrame = originalCFrame
				end

				targetFound = true
				break -- only work on one player at a time
			end
		end
	end

	if not targetFound then
		task.wait(0.5)
	end
end
