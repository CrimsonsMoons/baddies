local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local Remote = ReplicatedStorage:WaitForChild("Event", 9e9)

--- SETTINGS
local MY_HP_TRIGGER = 1            -- ONLY RUN WHEN YOU ARE 1 HP
local STOMP_HP_TRIGGER = 1         -- stomp when enemy is 1 HP or less
local HIT_DELAY = 0.1
local STOMP_SPAM = 6
local STOMP_DELAY = 0.05
local BEHIND_DISTANCE = 2

-- Helpers
local function hum(char)
	return char and char:FindFirstChildOfClass("Humanoid")
end

local function hrp(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

local function hit(targetHRP)
	Remote:FireServer({
		Event = "Hit",
		ClientHitbox = {
			targetHRP
		}
	})
end

local function stomp()
	Remote:FireServer({
		Event = "Stomp"
	})
end

while true do
	task.wait(0.15)

	local myChar = LocalPlayer.Character
	local myHum = hum(myChar)
	local myHRP = hrp(myChar)

	-- âŒ DO NOTHING UNLESS YOU ARE 1 HP
	if not myHum or not myHRP or myHum.Health > MY_HP_TRIGGER then
		continue
	end

	local originalCF = myHRP.CFrame

	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character then
			local tChar = plr.Character
			local tHum = hum(tChar)
			local tHRP = hrp(tChar)

			if tHum and tHRP and tHum.Health > 0 then

				-- ðŸŸ¢ ATTACK PHASE (enemy HP ABOVE 1)
				while tHum.Health > STOMP_HP_TRIGGER
					and myHum.Health <= MY_HP_TRIGGER do

					-- TP BEHIND + FACE TARGET
					myHRP.CFrame = CFrame.new(
						tHRP.Position - tHRP.CFrame.LookVector * BEHIND_DISTANCE,
						tHRP.Position
					)

					hit(tHRP)
					task.wait(HIT_DELAY)
				end

				-- ðŸ”´ STOMP PHASE (enemy HP â‰¤ 1)
				if tHum.Health <= STOMP_HP_TRIGGER then
					myHRP.CFrame = tHRP.CFrame
					for i = 1, STOMP_SPAM do
						stomp()
						task.wait(STOMP_DELAY)
					end
				end

				-- RETURN TO ORIGINAL POSITION
				myHRP.CFrame = originalCF
			end
		end
	end
end
